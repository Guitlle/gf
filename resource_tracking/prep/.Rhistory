library(readxl)
excel_data <- read_excel("C:/Users/irenac2/Documents/2013%20%20FONDO%20MUNDIAL%20MALARIA.xls")
excel_data <- read_excel("C:/Users/irenac2/Documents/2013  FONDO MUNDIAL MALARIA.xls")
excel_data <- read_excel("C:/Users/irenac2/Documents/2013 MALARIA PRESUPUESTO POR ORGANISMO (departamento municipio).xls",
range='B247:AV302'
)
View(excel_data)
?type
typeof(excel_data)
library(data.table)
install.packages(data.table)
install.packages("data.table")
gf_data <- data.frame(excel_data)
View(gf_data)
typeof(gf_data)
gf_data<- Filter(function(x)!all(is.na(x)), gf_data)
View(gf_data)
source('C:/Users/irenac2/repos/gf/resource_tracking/prep/prep_sicoin.R')
source('C:/Users/irenac2/repos/gf/resource_tracking/prep/prep_sicoin.R')
install.packages('reshap2')
install.packages('reshape2')
rm(list=ls())
library(data.table)
library(reshape2)
library(stringr)
library(readxl)
gf_data <- read_excel("C:/Users/irenac2/Documents/2013 MALARIA PRESUPUESTO POR ORGANISMO (departamento municipio).xls",
range='B247:AV302'
)
gf_data<- Filter(function(x)!all(is.na(x)), gf_data)
View(gf_data)
?unique
unique(gf_data$X__3)
gf_subset <- gf_data[gf_data$X__3="TOTAL"]
gf_subset <- gf_data[gf_data$X__3=="TOTAL"]
gf_subset <- gf_data[gf_data$X__3!="TOTAL"]
?grep
gf_subset <- gf_data[ grep("TOTAL", gf_data$X__3, invert = TRUE) , ]
View(gf_subset)
gf_subset <- gf_subset[ grep(!is.na(gf_subset$X__1), gf_subset$X__1, invert = TRUE) , ]
gf_subset <- gf_subset[ grep(!is.na(gf_subset$`0100`), gf_subset$`0100`, invert = TRUE) , ]
View(gf_subset)
View(gf_subset)
?char
?is.na()
gf_subset <- gf_subset[gf_subset$`0100`(is.na(gf_subset$`0100`))]
gf_subset <- gf_subset[(is.na(gf_subset$`0100`)]
View(gf_subset)
?apply
row.has.na <- apply(gf_subset $X__9, 2, function(x){any(is.na(x))})
row.has.na <- apply(gf_subset $X__9, 1, function(x){any(is.na(x))})
gf_subset <- data.frame(gf_data[ grep("TOTAL", gf_data$X__3, invert = TRUE) , ])
row.has.na <- apply(gf_subset $X__9, 1, function(x){any(is.na(x))})
gf_subset <- data.table(gf_data[ grep("TOTAL", gf_data$X__3, invert = TRUE) , ])
gf_subset <- na.omit(gf_subset, cols="X__9")
View(gf_subset)
budget_dataset <- subset(gf_subset[gf_subset$X__9, gf_subset$X__14])
budget_dataset <- gf_subset[, c("X__9", "X__14"), with=FALSE]
View(budget_dataset)
names(budget_dataset) <- c("loc_id", "budgeted_amount")
View(budget_dataset)
source('C:/Users/irenac2/repos/gf/resource_tracking/prep/prep_sicoin.R')
View(budget_dataset)
budget_dataset <- gf_subset[, c("X__9", "X__17"), with=FALSE]
names(budget_dataset) <- c("loc_id", "budgeted_amount")
View(budget_dataset)
gf_data <- read_excel("C:/Users/irenac2/Documents/2013 MALARIA PRESUPUESTO POR ORGANISMO (departamento municipio).xls")
View(gf_data)
View(budget_dataset)
View(gf_data)
gf_data$X__8[13]
budget_year <- gf_data$X__8[13]
## remove empty columns
gf_data<- Filter(function(x)!all(is.na(x)), gf_data)
View(gf_data)
subset(gf_data, c(X__10 %in% "MUNDIAL", X__6 %in% "MUNDIAL"))
out <- subset(gf_data, c(X__10 %in% "MUNDIAL", X__6 %in% "MUNDIAL"))
View(out)
out <- NULL
?subset\
?subset
library(dplyr)
require(dplyr)
install.packages("dplyr")
library(dplyr)
library(plyr)
gf_sub<- subset(gf_data, X__10 %in% "MUNDIAL"| X__6 %in% "MUNDIAL")
View(gf_sub)
View(gf_data)
which(gf_data$X__10 %in% "MUNDIAL")
View(gf_data)
which(gf_data$X__10 %in% "FONDO MUNDIAL")
which(gf_data$X__6 %in% "0425 FONDO MUNDIAL")
View(gf_data)
which(gf_data$X__6 %in% "FONDO MUNDIAL")
which(gf_data$X__6 %in% "0425 FONDO MUNDIAL")
gf_data$X__6
which(gf_data$X__6 %in% "0425  FONDO MUNDIAL" )
out <- gf_data[c(X__10 %in% "MUNDIAL", X__6 %in% "MUNDIAL"),]
out <- gf_data[c(gf_data$X__10 %in% "MUNDIAL", gf_data$X__6 %in% "MUNDIAL"),]
out <- gf_data[c(gf_data$X__10 %in% "MUNDIAL":gf_data$X__6 %in% "MUNDIAL"),]
out <- gf_data[c(which(gf_data$X__10 %in% "FONDO MUNDIAL"):which(gf_data$X__6 %in% "0425  FONDO MUNDIAL")),]
View(out)
##pull data between these two indices
gf_data <- gf_data[c(which(gf_data$X__10 %in% "FONDO MUNDIAL"):which(gf_data$X__6 %in% "0425  FONDO MUNDIAL")),]
# remove rows with "TOTAL" (they are redundant from looking at the original file),
gf_subset <- data.table(gf_data[ grep("TOTAL", gf_data$X__3, invert = TRUE) , ])
View(gf_subset)
View(gf_subset)
# remove rows where X__9 has a value (they are redundant),
gf_subset <- na.omit(gf_subset, cols="X__10")
View(gf_subset)
dir <- 'C:/Users/irenac2/Documents/'
inFile <- paste0(dir, '2013 MALARIA PRESUPUESTO POR ORGANISMO (departamento municipio).xls')
gf_dat1 <- read_excel(inFile)
View(gf_dat1)
source('C:/Users/irenac2/repos/gf/resource_tracking/prep/prep_sicoin.R')
View(gf_subset)
budget_dataset <- gf_subset[, c("X__10", "X__19" "X__26"), with=FALSE]
budget_dataset <- gf_subset[, c("X__10", "X__19", "X__26"), with=FALSE]
View(budget_dataset)
gf_data <- gf_data[c(which(gf_data$X__10 %in% "FONDO MUNDIAL")+1:which(gf_data$X__6 %in% "0425  FONDO MUNDIAL")),]
gf_subset <- data.table(gf_data[ grep("TOTAL", gf_data$X__3, invert = TRUE) , ])
gf_subset <- na.omit(gf_subset, cols="X__10")
View(gf_subset)
which(gf_data$X__10 %in% "FONDO MUNDIAL")+1
which(gf_data$X__10 %in% "FONDO MUNDIAL")
View(gf_data)
which(gf_data$X__6 %in% "0425  FONDO MUNDIAL")
which(gf_data$X__10 %in% "FONDO MUNDIAL")
gf_data <- read_excel(inFile)
budget_year <- gf_data$X__8[13]
gf_data<- Filter(function(x)!all(is.na(x)), gf_data)
which(gf_data$X__10 %in% "FONDO MUNDIAL")+1
##pull data between these two indices
gf_data <- gf_data[c(which(gf_data$X__10 %in% "FONDO MUNDIAL")+1:which(gf_data$X__6 %in% "0425  FONDO MUNDIAL")),]
gf_subset <- data.table(gf_data[ grep("TOTAL", gf_data$X__3, invert = TRUE) , ])
gf_subset <- na.omit(gf_subset, cols="X__10")
View(gf_subset)
gf_data <- read_excel(inFile)
budget_year <- gf_data$X__8[13]
gf_data<- Filter(function(x)!all(is.na(x)), gf_data)
gf_data <- gf_data[c(which(gf_data$X__10 %in% "FONDO MUNDIAL"):which(gf_data$X__6 %in% "0425  FONDO MUNDIAL")),]
View(gf_data)
# load - figure out how to load
gf_data <- read_excel(inFile)
## variable for the year
budget_year <- gf_data$X__8[13]
## remove empty columns
gf_data<- Filter(function(x)!all(is.na(x)), gf_data)
gf_data <- gf_data[c(1+which(gf_data$X__10 %in% "FONDO MUNDIAL"):which(gf_data$X__6 %in% "0425  FONDO MUNDIAL")),]
View(gf_data)
gf_data <- read_excel(inFile)
## variable for the year
budget_year <- gf_data$X__8[13]
## remove empty columns
gf_data<- Filter(function(x)!all(is.na(x)), gf_data)
gf_data <- gf_data[c(which(gf_data$X__10 %in% "FONDO MUNDIAL"):which(gf_data$X__6 %in% "0425  FONDO MUNDIAL")),]
# remove rows with "TOTAL" (they are redundant from looking at the original file),
gf_subset <- data.table(gf_data[ grep("TOTAL", gf_data$X__3, invert = TRUE) , ])
# remove rows where X__10 has a value (they are redundant),
gf_subset <- na.omit(gf_subset, cols="X__10")
# subset observations
## get region + budgeted expenses
budget_dataset <- gf_subset[, c("X__10", "X__19", "X__26"), with=FALSE]
names(budget_dataset) <- c("loc_id", "vigente", "devengado")
View(budget_dataset)
# load - figure out how to load
gf_data <- read_excel(inFile)
## variable for the year
budget_year <- gf_data$X__8[13]
## remove empty columns
gf_data<- Filter(function(x)!all(is.na(x)), gf_data)
##pull data between these two indices
gf_data <- gf_data[c(which(gf_data$X__10 %in% "FONDO MUNDIAL"+1):which(gf_data$X__6 %in% "0425  FONDO MUNDIAL")),]
##pull data between these two indices
gf_data <- gf_data[c(which(gf_data$X__10 %in% "FONDO MUNDIAL")+1:which(gf_data$X__6 %in% "0425  FONDO MUNDIAL")),]
View(gf_data)
##pull data between these two indices
gf_data <- gf_data[c(which(gf_data$X__10 %in% "FONDO MUNDIAL"):which(gf_data$X__6 %in% "0425  FONDO MUNDIAL")),]
## remove empty columns
gf_data<- Filter(function(x)!all(is.na(x)), gf_data)
##pull data between these two indices
gf_data <- gf_data[c(which(gf_data$X__10 %in% "FONDO MUNDIAL"):which(gf_data$X__6 %in% "0425  FONDO MUNDIAL")),]
# load - figure out how to load
gf_data <- read_excel(inFile)
## variable for the year
budget_year <- gf_data$X__8[13]
## remove empty columns
gf_data<- Filter(function(x)!all(is.na(x)), gf_data)
##pull data between these two indices
gf_data <- gf_data[c(which(gf_data$X__10 %in% "FONDO MUNDIAL"):which(gf_data$X__6 %in% "0425  FONDO MUNDIAL")),]
View(gf_data)
# remove rows with "TOTAL" (they are redundant from looking at the original file),
gf_subset <- data.table(gf_data[ grep("TOTAL", gf_data$X__3, invert = TRUE) , ])
# remove rows where X__10 has a value (they are redundant),
gf_subset <- na.omit(gf_subset, cols="X__10")
# subset observations
## get region + budgeted expenses
budget_dataset <- gf_subset[, c("X__10", "X__19", "X__26"), with=FALSE]
names(budget_dataset) <- c("loc_id", "vigente", "devengado")
View(budget_dataset)
budget_dataset <- budget_dataset[2:length(budget_dataset)]
View(budget_dataset)
## get region + budgeted expenses
budget_dataset <- gf_subset[, c("X__10", "X__19", "X__26"), with=FALSE]
names(budget_dataset) <- c("loc_id", "vigente", "devengado")
budget_dataset <- budget_dataset[2:length(budget_dataset),]
View(budget_dataset)
budget_dataset <- gf_subset[, c("X__10", "X__19", "X__26"), with=FALSE]
names(budget_dataset) <- c("loc_id", "vigente", "devengado")
budget_dataset <- budget_dataset[2:length(budget_dataset$loc_id),]
View(budget_dataset)
budget_dataset <- budget_dataset[3:length(budget_dataset$loc_id),]
View(budget_dataset)
budget_dataset$start_year <- budget_year
View(budget_dataset)
as.Date()
?as.Date
budget_dataset$start_year <- as.Date(budget_year)
typeof(budget_year)
budget_year <- as.numeric(gf_data$X__8[13])
typeof(budget_year)
budget_dataset$start_year <- as.Date(budget_year)
budget_dataset$start_year <- as.Date(budget_year, origin = "1960-10-01")
View(budget_dataset)
budget_dataset$start_date <- as.Date(budget_year, origin = "1960-10-01")
View(budget_dataset)
typeof(budget_dataset$start_date)
budget_dataset$start_year <- NULL
budget_dataset$start_date <- as.Date(paste(budget_year, 1, 1, sep = "-"))
?paste
budget_dataset$start_date <- as.Date(budget_year, 1, 1, sep = "-")
budget_dataset$start_date <- as.Date(budget_year, 1, 1, sep = "-", origin="1970-01-01")
budget_dataset$start_date <- as.Date(budget_year, 1, 1, sep = "-", origin="1960-01-01")
budget_dataset$period <- budget_period
##change if time period is different
budget_period <- 365
budget_dataset$period <- budget_period
View(budget_dataset)
budget_period <- 365
budget_source <- 'gf'
## will want to change this part of the code when appending multiple budgets:
budget_dataset$source <- budget_source
budget_dataset$period <- budget_period
View(budget_dataset)
source('C:/Users/irenac2/repos/gf/resource_tracking/prep/prep_sicoin.R')
budget_year <- gf_data$X__8[13]+"-01"+"-01"
?paste()
budget_year <- paste(c(gf_data$X__8[13],"01","01"), sep="-")
budget_year
gf_data <- read_excel(inFile)
budget_year <- paste(c(gf_data$X__8[13],"01","01"), sep="-")
budget_year <- paste(c(gf_data$X__8[13],"01","01"), sep="/")
budget_year <- paste(c(gf_data$X__8[13],"01","01"), collapse="-")
budget_dataset$start_date <- as.Date(budget_year, origin="1960-01-01")
View(budget_dataset)
budget_dataset$start_date <- as.Date(budget_year, origin="1960-01-01")
budget_dataset$source <- budget_source
budget_dataset$period <- budget_period
View(budget_dataset)
##change if time period is different
budget_period <- 365
budget_source <- 'gf'
## remove empty columns
gf_data<- Filter(function(x)!all(is.na(x)), gf_data)
##pull data between these two indices
gf_data <- gf_data[c(which(gf_data$X__10 %in% "FONDO MUNDIAL"):which(gf_data$X__6 %in% "0425  FONDO MUNDIAL")),]
# remove rows with "TOTAL" (they are redundant from looking at the original file),
gf_subset <- data.table(gf_data[ grep("TOTAL", gf_data$X__3, invert = TRUE) , ])
# remove rows where X__10 has a value (they are redundant),
gf_subset <- na.omit(gf_subset, cols="X__10")
# subset observations
## get region + budgeted expenses
budget_dataset <- gf_subset[, c("X__10", "X__19", "X__26"), with=FALSE]
names(budget_dataset) <- c("loc_id", "vigente", "devengado")
## we only want the municpalities so get rid of GF and Guatemala
budget_dataset <- budget_dataset[3:length(budget_dataset$loc_id),]
# ----------------------------------------------
budget_dataset$start_date <- as.Date(budget_year, origin="1960-01-01")
budget_dataset$source <- budget_source
budget_dataset$period <- budget_period
View(budget_dataset)
source('C:/Users/irenac2/repos/gf/resource_tracking/prep/prep_sicoin.R')
gf_data <- read_excel(inFile)
View(gf_data)
## variable for the year
budget_year <- paste(c(gf_data$X__8[13],"01","01"), collapse="-")
##change if time period is different
budget_period <- 365
budget_source <- 'gf'
## remove empty columns
gf_data<- Filter(function(x)!all(is.na(x)), gf_data)
View(gf_data)
gf_data <- gf_data[c(which(gf_data$X__10 %in% "FONDO MUNDIAL"):which(gf_data$X__6 %in% "0425  FONDO MUNDIAL")),]
View(gf_data)
# remove rows with "TOTAL" (they are redundant from looking at the original file),
gf_subset <- data.table(gf_data[ grep("TOTAL", gf_data$X__3, invert = TRUE) , ])
View(gf_data)
# remove rows where X__10 is missing a value (they are redundant),
gf_subset <- na.omit(gf_subset, cols="X__10")
# subset observations
## get region + budgeted expenses
budget_dataset <- gf_subset[, c("X__10", "X__19", "X__26"), with=FALSE]
names(budget_dataset) <- c("loc_id", "vigente", "devengado")
## we only want the municpalities so get rid of GF and Guatemala
budget_dataset <- budget_dataset[3:length(budget_dataset$loc_id),]
View(budget_dataset)
budget_dataset$source <- budget_source
budget_dataset$start_date <- as.Date(budget_year, origin="1960-01-01")
budget_dataset$period <- budget_period
View(budget_dataset)
inFile <- paste0(dir, '2014 MALARIA PRESUPUESTO POR ORGANISMO (departamento municipio).xls')
gf_test_data <- read_excel(inFile)
# input file
inFile <- paste0(dir, '2014 MALARIA PRESUPUESTO POR ORGANISMO  (departamento municipio).xls')
gf_test_data <- read_excel(inFile)
budget_year <- paste(c(gf_data$X__8[13],"01","01"), collapse="-")
##change if time period is different
budget_period <- 365
budget_source <- 'gf'
budget_year <- paste(c(gf_test_data$X__8[13],"01","01"), collapse="-")
gf_data<- Filter(function(x)!all(is.na(x)), gf_data)
gf_test_data<- Filter(function(x)!all(is.na(x)), gf_test_data)
View(gf_test_data)
gf_test_data <- gf_test_data[c(which(gf_test_data$X__10 %in% "FONDO MUNDIAL"):which(gf_test_data$X__6 %in% "0425  FONDO MUNDIAL")),]
View(gf_test_data)
# remove rows with "TOTAL" (they are redundant from looking at the original file),
gf_test_subset <- data.table(gf_test_data[ grep("TOTAL", gf_data$X__3, invert = TRUE) , ])
# remove rows where X__10 is missing a value (they are redundant),
gf_test_subset <- na.omit(gf_test_subset, cols="X__10")
# subset observations
View(gf_test_subset)
## get region + budgeted expenses
budget_dataset <- gf_subset[, c("X__10", "X__19", "X__26"), with=FALSE]
names(budget_dataset) <- c("loc_id", "vigente", "devengado")
## get region + budgeted expenses
budget_test_dataset <- gf_test_subset[, c("X__10", "X__19", "X__26"), with=FALSE]
names(budget_test_dataset) <- c("loc_id", "vigente", "devengado")
View(budget_test_dataset)
## we only want the municpalities so get rid of GF and Guatemala
budget_test_dataset <- budget_test_dataset[3:length(budget_test_dataset$loc_id),]
View(budget_test_dataset)
budget_test_year <- paste(c(gf_data$X__8[13],"01","01"), collapse="-")
budget_test_dataset$period <- budget_period
budget_test_dataset $source <- budget_source
budget_test_dataset $start_date <- as.Date(budget_test_year, origin="1960-01-01")
budget_test_dataset$period <- budget_period
View(budget_test_dataset)
budget_test_year <- paste(c(gf_data$X__8[13],"01","01"), collapse="-")
gf_test_data <- read_excel(inFile)
budget_test_year <- paste(c(gf_test_data$X__8[13],"01","01"), collapse="-")
budget_test_dataset $source <- budget_source
budget_test_dataset $start_date <- as.Date(budget_test_year, origin="1960-01-01")
budget_test_dataset$period <- budget_period
View(budget_test_dataset)
combineddataset = rbind(budget_dataset, budget_test_dataset)
View(budget_dataset)
budget_year <- paste(c(gf_data$X__8[13],"01","01"), collapse="-")
##change if time period is different
budget_period <- 365
budget_source <- 'gf'
budget_dataset$source <- budget_source
budget_dataset$start_date <- as.Date(budget_year, origin="1960-01-01")
budget_dataset$period <- budget_period
gf_data <- read_excel(inFile)
budget_year <- paste(c(gf_data$X__8[13],"01","01"), collapse="-")
budget_dataset$source <- budget_source
budget_dataset$start_date <- as.Date(budget_year, origin="1960-01-01")
budget_dataset$period <- budget_period
combineddataset = rbind(budget_dataset, budget_test_dataset)
View(combineddataset)
dir <- 'C:/Users/irenac2/Documents/'
# input file
inFile <- paste0(dir, '2013 MALARIA PRESUPUESTO POR ORGANISMO (departamento municipio).xls')
gf_data <- read_excel(inFile)
budget_year <- paste(c(gf_data$X__8[13],"01","01"), collapse="-")
budget_dataset$source <- budget_source
budget_dataset$start_date <- as.Date(budget_year, origin="1960-01-01")
budget_dataset$period <- budget_period
combineddataset = rbind(budget_dataset, budget_test_dataset)
View(combineddataset)
View(budget_dataset)
gf_data<- Filter(function(x)!all(is.na(x)), gf_data)
##pull data between these two indices
gf_data <- gf_data[c(which(gf_data$X__10 %in% "FONDO MUNDIAL"):which(gf_data$X__6 %in% "0425  FONDO MUNDIAL")),]
# remove rows with "TOTAL" (they are redundant from looking at the original file),
gf_subset <- data.table(gf_data[ grep("TOTAL", gf_data$X__3, invert = TRUE) , ])
# remove rows where X__10 is missing value (they are redundant),
gf_subset <- na.omit(gf_subset, cols="X__10")
# subset observations
## get region + budgeted expenses
budget_dataset <- gf_subset[, c("X__10", "X__19", "X__26"), with=FALSE]
names(budget_dataset) <- c("loc_id", "vigente", "devengado")
## we only want the municpalities so get rid of GF and Guatemala
budget_dataset <- budget_dataset[3:length(budget_dataset$loc_id),]
View(budget_dataset)
budget_dataset$source <- budget_source
budget_dataset$start_date <- as.Date(budget_year, origin="1960-01-01")
budget_dataset$period <- budget_period
combineddataset = rbind(budget_dataset, budget_test_dataset)
View(combineddataset)
source('C:/Users/irenac2/repos/gf/resource_tracking/prep/prep_sicoin.R')
source('C:/Users/irenac2/repos/gf/resource_tracking/prep/prep_sicoin.R')
source('C:/Users/irenac2/repos/gf/resource_tracking/prep/prep_sicoin.R')
View(budget_dataset)
View(gf_data)
